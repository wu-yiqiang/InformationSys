"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getEmmetConfiguration = exports.updateConfigs = void 0;
const vscode_vue_languageservice_1 = require("@volar/vscode-vue-languageservice");
const instances_1 = require("./instances");
let emmetConfig;
function updateConfigs() {
    updateCodeLensConfig();
    updateEmmetConfig();
    async function updateCodeLensConfig() {
        const [codeLensReferences, codeLensPugTool, codeLensRefScriptSetupTool,] = await Promise.all([
            instances_1.connection.workspace.getConfiguration('volar.codeLens.references'),
            instances_1.connection.workspace.getConfiguration('volar.codeLens.pugTools'),
            instances_1.connection.workspace.getConfiguration('volar.codeLens.scriptSetupTools'),
        ]);
        vscode_vue_languageservice_1.codeLensOptions.references = codeLensReferences;
        vscode_vue_languageservice_1.codeLensOptions.pugTool = codeLensPugTool;
        vscode_vue_languageservice_1.codeLensOptions.scriptSetupTool = codeLensRefScriptSetupTool;
    }
    async function updateEmmetConfig() {
        emmetConfig = await instances_1.connection.workspace.getConfiguration('emmet');
    }
}
exports.updateConfigs = updateConfigs;
function getEmmetConfiguration(syntax) {
    const syntaxProfiles = Object.assign({}, emmetConfig['syntaxProfiles'] || {});
    const preferences = Object.assign({}, emmetConfig['preferences'] || {});
    // jsx, xml and xsl syntaxes need to have self closing tags unless otherwise configured by user
    if (syntax === 'jsx' || syntax === 'xml' || syntax === 'xsl') {
        syntaxProfiles[syntax] = syntaxProfiles[syntax] || {};
        if (typeof syntaxProfiles[syntax] === 'object'
            && !syntaxProfiles[syntax].hasOwnProperty('self_closing_tag') // Old Emmet format
            && !syntaxProfiles[syntax].hasOwnProperty('selfClosingStyle') // Emmet 2.0 format
        ) {
            syntaxProfiles[syntax] = {
                ...syntaxProfiles[syntax],
                selfClosingStyle: 'xml'
            };
        }
    }
    return {
        preferences,
        showExpandedAbbreviation: emmetConfig['showExpandedAbbreviation'],
        showAbbreviationSuggestions: emmetConfig['showAbbreviationSuggestions'],
        syntaxProfiles,
        variables: emmetConfig['variables'],
        excludeLanguages: emmetConfig['excludeLanguages'],
        showSuggestionsAsSnippets: emmetConfig['showSuggestionsAsSnippets']
    };
}
exports.getEmmetConfiguration = getEmmetConfiguration;
//# sourceMappingURL=configs.js.map